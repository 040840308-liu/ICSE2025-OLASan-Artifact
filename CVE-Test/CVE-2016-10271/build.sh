#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/libtiff" ]; then
    git clone https://gitlab.com/libtiff/libtiff.git
fi

cd libtiff
git reset --hard v4.0.7

./autogen.sh
./configure \
  CC=/home/test/workspace-15/llvm/build/bin/clang \
  CXX=/home/test/workspace-15/llvm/build/bin/clang++ \
  CFLAGS="-g -g -ggdb -fsanitize=hwaddress" \
  CXXFLAGS="-g -g -ggdb -fsanitize=hwaddress" \
  --disable-shared

make clean
make -j`nproc`
# ./libtiff/tools//tiffcrop -i ./00100-libtiff-heapoverflow-_TIFFFax3fillruns /tmp/foo
